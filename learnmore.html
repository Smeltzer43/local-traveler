<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Your Next Steps - Global Travel & Lifestyle Club</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              50: '#e6fffb', 100: '#c8fff6', 200: '#96f2ea', 300: '#5ee9de', 400: '#2ed3c6',
              500: '#0fb9b1', 600: '#0aa39c', 700: '#0a8a84', 800: '#0b6f6b', 900: '#0b5856'
            },
            peach: {
              50: '#fff1f0', 100: '#ffe3e0', 200: '#ffcfc8', 300: '#ffb6a9', 400: '#ff9a8b',
              500: '#ff816f', 600: '#f46b5d', 700: '#de594d', 800: '#c74a40', 900: '#a93a31'
            },
            'warm-teal': '#0fb9b1',
            'pinky-peach': '#ff9a8b'
          }
        }
      }
    }
  </script>
</head>
<body class="bg-gradient-to-br from-brand-50 to-white min-h-screen">
  <!-- Header -->
  <header class="bg-white shadow-sm border-b border-brand-100">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <div class="flex items-center justify-between">
        <a href="index.html" class="flex items-center gap-2 font-semibold tracking-tight" onclick="return confirmNavigation(event)">
          <span class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-brand-100 text-brand-700">LT</span>
          <span class="text-brand-800">The Local Travelers</span>
        </a>
        <a href="index.html" class="text-brand-600 hover:text-brand-700 font-medium" onclick="return confirmNavigation(event)">← Back to Home</a>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Welcome Section -->
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold text-slate-800 mb-4">Welcome to Your Journey!</h1>
      <p class="text-xl text-slate-600 mb-6">Thank you for confirming your email. Chad & Christina are excited to share this opportunity with you.</p>
      <div class="bg-brand-50 border border-brand-200 rounded-xl p-6">
        <p class="text-brand-800 font-medium">You're now ready to discover how thousands are creating freedom through travel and income!</p>
      </div>
    </div>

    <!-- Step 1: Introduction Video -->
    <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
      <div class="flex items-center mb-6">
        <div class="flex items-center justify-center w-12 h-12 bg-brand-600 text-white rounded-full font-bold text-lg mr-4">1</div>
        <h2 class="text-2xl font-bold text-slate-800">Meet Chad & Christina</h2>
      </div>
      <p class="text-slate-600 mb-6">First, let Chad & Christina introduce themselves and share their story of how they discovered this opportunity.</p>
      
      <!-- Chad & Christina Introduction Video -->
      <div class="flex justify-center mb-6">
        <div class="relative w-80 h-[600px] bg-black rounded-xl overflow-hidden">
          <iframe 
            src="https://www.youtube.com/embed/oL5W1uO6SKw" 
            class="w-full h-full"
            frameborder="0" 
            allow="autoplay; fullscreen; picture-in-picture" 
            allowfullscreen>
          </iframe>
        </div>
      </div>
      
    </div>

    <!-- Step 2: Business Overview -->
    <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
      <div class="flex items-center mb-6">
        <div class="flex items-center justify-center w-12 h-12 bg-brand-600 text-white rounded-full font-bold text-lg mr-4">2</div>
        <h2 class="text-2xl font-bold text-slate-800">Business Overview</h2>
      </div>
      <p class="text-slate-600 mb-6">Now, let's dive into the business model and understand how this travel & lifestyle opportunity works.</p>
      
      <!-- Business Overview Video -->
      <div class="relative w-full" style="padding-bottom: 56.25%;">
        <iframe 
          src="https://player.vimeo.com/video/1092330715" 
          class="absolute top-0 left-0 w-full h-full rounded-xl"
          frameborder="0" 
          allow="autoplay; fullscreen; picture-in-picture" 
          allowfullscreen>
        </iframe>
      </div>
      
    </div>

    <!-- Step 3: Chad & Christina Direct to Next Video -->
    <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
      <div class="flex items-center mb-6">
        <div class="flex items-center justify-center w-12 h-12 bg-brand-600 text-white rounded-full font-bold text-lg mr-4">3</div>
        <h2 class="text-2xl font-bold text-slate-800">Your Next Video</h2>
      </div>
      <p class="text-slate-600 mb-6">Chad & Christina have a special message for you about what to watch next.</p>
      
      <!-- Chad & Christina Direct Video -->
      <div class="flex justify-center mb-6">
        <div class="relative w-80 h-[600px] bg-black rounded-xl overflow-hidden">
          <iframe 
            src="https://www.youtube.com/embed/h79QiAdeOJQ" 
            class="w-full h-full"
            frameborder="0" 
            allow="autoplay; fullscreen; picture-in-picture" 
            allowfullscreen>
          </iframe>
        </div>
      </div>
      
    </div>

    <!-- Step 4: Compensation Plan -->
    <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
      <div class="flex items-center mb-6">
        <div class="flex items-center justify-center w-12 h-12 bg-brand-600 text-white rounded-full font-bold text-lg mr-4">4</div>
        <h2 class="text-2xl font-bold text-slate-800">Compensation Plan</h2>
      </div>
      <p class="text-slate-600 mb-6">Finally, discover how you can earn income through this opportunity and what the compensation structure looks like.</p>
      
      <!-- Compensation Plan Video -->
      <div class="relative w-full" style="padding-bottom: 56.25%;">
        <iframe 
          src="https://www.youtube.com/embed/FA3LVNu0cec" 
          class="absolute top-0 left-0 w-full h-full rounded-xl"
          frameborder="0" 
          allow="autoplay; fullscreen; picture-in-picture" 
          allowfullscreen>
        </iframe>
      </div>
      
    </div>

    <!-- Step 5: Chad & Christina Final Call to Action -->
    <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
      <div class="flex items-center mb-6">
        <div class="flex items-center justify-center w-12 h-12 bg-brand-600 text-white rounded-full font-bold text-lg mr-4">5</div>
        <h2 class="text-2xl font-bold text-slate-800">Your Decision</h2>
      </div>
      <p class="text-slate-600 mb-6">Chad & Christina have one final message for you about choosing your next step.</p>
      
      <!-- Chad & Christina Final Video -->
      <div class="flex justify-center mb-6">
        <div class="relative w-80 h-[600px] bg-black rounded-xl overflow-hidden">
          <iframe 
            src="https://www.youtube.com/embed/Buf2XvkdEKs" 
            class="w-full h-full"
            frameborder="0" 
            allow="autoplay; fullscreen; picture-in-picture" 
            allowfullscreen>
          </iframe>
        </div>
      </div>
      
    </div>

    <!-- Next Steps -->
    <div class="bg-gradient-to-r from-brand-600 to-brand-700 rounded-2xl shadow-lg p-8 text-white">
      <h2 class="text-2xl font-bold mb-4">Ready for Your Next Steps?</h2>
      <p class="text-brand-100 mb-8">After getting to know us and more about this opportunity, you're ready to take action! Choose your next step below.</p>
      
      <div class="grid md:grid-cols-2 gap-6">
        <!-- Access Page Link -->
        <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6">
          <h3 class="text-xl font-bold mb-3">Get Started</h3>
          <p class="text-brand-100 mb-4">Ready to join? Access your member portal and begin your journey.</p>
          <a href="https://www.mwrlife.com/thelocaltravelers/join" class="inline-flex items-center justify-center w-full bg-white text-brand-600 font-semibold px-6 py-3 rounded-lg hover:bg-brand-50 transition-colors">
            Access Member Portal
          </a>
        </div>
        
        <!-- Calendar Link -->
        <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6">
          <h3 class="text-xl font-bold mb-3">Schedule a Call</h3>
          <p class="text-brand-100 mb-4">Have questions? Schedule a call with Chad & Christina.</p>
          <a href="https://calendly.com/christinaroberson/15min" class="inline-flex items-center justify-center w-full bg-white text-brand-600 font-semibold px-6 py-3 rounded-lg hover:bg-brand-50 transition-colors">
            Book a Call
          </a>
        </div>
      </div>
      
      <div class="mt-6 text-center">
        <p class="text-brand-100 text-sm">Questions? Email us at <a href="mailto:crsmeltzer@gmail.com" class="underline hover:text-white">crsmeltzer@gmail.com</a></p>
        <p class="text-brand-100 text-sm mt-2">Need to start over? <a href="index.html" class="underline hover:text-white" onclick="return confirmNavigation(event)">Return to Home Page</a></p>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-slate-800 text-white py-8 mt-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <p class="text-slate-400">© <span id="year"></span> The Local Travelers. All rights reserved.</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Supabase Configuration
    const SUPABASE_URL = 'https://jxytzukoqwmcrlldsbpo.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp4eXR6dWtvcXdtY3JsbGRzYnBvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3MDg2ODEsImV4cCI6MjA3NjI4NDY4MX0.movYhVr-GJlznL9Bcxs9Zh-yLmdhYBRzSh3I8GfwyP8';
    
    // Initialize Supabase client
    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    // Function to capture lead data when user authenticates
    async function captureLeadData(user) {
      try {
        console.log('Capturing lead data for authenticated user:', user.email);
        
        // Check if lead already exists
        const { data: existingLead, error: checkError } = await supabaseClient
          .from('leads')
          .select('id')
          .eq('email', user.email)
          .single();
        
        if (checkError && checkError.code !== 'PGRST116') {
          console.error('Error checking existing lead:', checkError);
          return;
        }
        
        // If lead doesn't exist, create it
        if (!existingLead) {
          console.log('User metadata:', user.user_metadata);
          
          // Try to get names from localStorage as fallback
          const pendingData = localStorage.getItem('pendingLeadData');
          let firstName = 'Unknown';
          let lastName = 'User';
          
          if (pendingData) {
            try {
              const data = JSON.parse(pendingData);
              if (data.email === user.email) {
                firstName = data.firstName || 'Unknown';
                lastName = data.lastName || 'User';
                console.log('Using localStorage data:', { firstName, lastName });
              }
            } catch (e) {
              console.log('Error parsing localStorage data:', e);
            }
          }
          
          const { data: leadData, error: leadError } = await supabaseClient
            .from('leads')
            .insert([{
              first_name: user.user_metadata?.first_name || user.user_metadata?.firstName || firstName,
              last_name: user.user_metadata?.last_name || user.user_metadata?.lastName || lastName,
              email: user.email,
              source: 'magic_link_confirmed',
              created_at: new Date().toISOString()
            }]);
          
          if (leadError) {
            console.error('Lead capture error:', leadError);
            console.error('This might be due to RLS policies. Check SUPABASE_RLS_POLICY_FIX.md for solution.');
          } else {
            console.log('Lead captured successfully:', leadData);
          }
        } else {
          console.log('Lead already exists for this email');
        }
      } catch (err) {
        console.error('Lead capture error:', err);
      }
    }
    
    // Handle magic link authentication
    async function handleAuthCallback() {
      try {
        const { data, error } = await supabaseClient.auth.getSession();
        
        if (error) {
          console.error('Auth error:', error);
          // If there's an auth error, redirect to home page
          window.location.href = 'index.html';
          return;
        }
        
        if (data.session) {
          console.log('User authenticated:', data.session.user.email);
          // User is authenticated, show the content
          document.body.style.display = 'block';
          
          // Store session info persistently
          localStorage.setItem('authenticated', 'true');
          localStorage.setItem('userEmail', data.session.user.email);
          localStorage.setItem('authTimestamp', Date.now().toString());
          
          // Capture lead data now that user is authenticated
          console.log('User authenticated, attempting to capture lead data...');
          await captureLeadData(data.session.user);
        } else {
          // Check if user was previously authenticated (within last 7 days)
          const wasAuthenticated = localStorage.getItem('authenticated');
          const authTimestamp = localStorage.getItem('authTimestamp');
          const sevenDaysAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);
          
          if (wasAuthenticated === 'true' && authTimestamp && parseInt(authTimestamp) > sevenDaysAgo) {
            console.log('User was previously authenticated within 7 days, allowing access');
            document.body.style.display = 'block';
            return;
          }
          
          console.log('No active session or session expired, redirecting to home');
          // Clear old auth data
          localStorage.removeItem('authenticated');
          localStorage.removeItem('userEmail');
          localStorage.removeItem('authTimestamp');
          // No active session, redirect to home page
          window.location.href = 'index.html';
        }
      } catch (err) {
        console.error('Auth callback error:', err);
        window.location.href = 'index.html';
      }
    }
    
    // Run auth check when page loads
    handleAuthCallback();
    
    // Set current year
    document.getElementById('year').textContent = new Date().getFullYear();
    
    // Function to confirm navigation away from the page
    function confirmNavigation(event) {
      // Prevent default navigation
      if (event) {
        event.preventDefault();
      }
      
      const confirmed = confirm(
        "Are you sure you want to leave this page?\n\n" +
        "You'll need to use your magic link again to access these videos.\n\n" +
        "If you haven't finished watching all the videos, we recommend staying on this page to complete your journey."
      );
      
      if (confirmed) {
        // User confirmed, allow navigation
        window.location.href = 'index.html';
      }
      // If not confirmed, do nothing (stay on page)
      
      return false; // Always return false to prevent default link behavior
    }
  </script>
</body>
</html>